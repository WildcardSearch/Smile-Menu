var SmileMenu=(function(f,p){
"use strict";
var c={minLength:2,maxLength:30,minWidth:100,maxItems:5,fullText:0,lockSelection:1},t={instructions:"type a user name"},s={BACKSPACE:8,ENTER:13,SHIFT:16,CTRL:17,ALT:18,ESC:27,PAGE_UP:33,PAGE_DOWN:34,END:35,HOME:36,LEFT:37,UP:38,RIGHT:39,DOWN:40,INSERT:45,DELETE:46,NUMLOCK:144},g=(function(){function D(U){var T,R,S;this.editorInterface=U;S=this.editorInterface.getContainer();this.$popup=f("#sm_master_popup").clone().attr("id","");this.$spinner=this.$popup.find("div.sm_spinner").hide();this.$input=this.$popup.find("input.sm_popup_input");this.$inputDiv=this.$popup.find("div.sm_popup_input_container");this.$body=this.$popup.find("div.sm_popup_body");if(typeof S==="string"&&f("#"+S).length){this.$container=f("#"+S)}else{if(typeof S==="object"&&f(S).length){this.$container=f(S)}else{return false}}this.$container.append(this.$popup);this.$popup.css({left:"-1000px",top:"-1000px"}).show();this.inputHeight=this.$inputDiv.height();T=f("<div/>");R=f("<div/>",{"class":"sm_smilie_image"}).appendTo(T);T.append(Array(c.maxLength+1).join("M")).addClass("sm_popup_item");this.$body.html(T);this.lineHeight=r(T.height())+this.editorInterface.lineHeightModifier+r(T.css("paddingTop").replace("px",""))+r(T.css("paddingBottom").replace("px",""));this.$instructions=f("<span/>",{"class":"sm_popup_instructions"}).html(t.instructions);this.scrollWidthDiff=this.$body.width()-this.$body[0].scrollWidth;this.keyCache=new l(this);this.smilieCache=new a(this)}function O(S,R){this.$input.val(":");this.keyCache.setText(":");this.update();this.move(S,R);this.$popup.show();this.lastSelected=null;this.select();this.visible=true;this.$body.mouseover(f.proxy(this.onMouseMove,this));this.$body.click(f.proxy(this.onClick,this));f(document).click(f.proxy(this.hide,this));this.editorInterface.bindClick(f.proxy(this.hide,this));this.$input.keydown(f.proxy(this.onKeyDown,this));this.$input.keyup(f.proxy(this.updateCheck,this));this.$input.click(f.proxy(this.onInputClick,this));this.$input.focus()}function C(){this.$popup.hide();this.$body.off("mouseover",this.onMouseMove);this.$body.off("click",this.onClick);f(document).off("click",this.hide);this.editorInterface.unbindClick(this.hide);this.$input.off("keydown",this.onKeyDown);this.$input.off("keyup",this.updateCheck);this.$input.off("click",this.onInputClick);this.visible=false;this.$input.val("")}function J(V,U){var T,S=this.smilieCache.getlongestText(),R;this.width=0;R=f("<img/>",{"class":"sm_smilie_image",src:"images/smilies/smile.png"}).css({left:"-1000px",top:"-1000px"}).appendTo(this.$container);this.width+=R.width();R.remove();this.width+=r(this.$body.css("fontSize").replace("px","")*S);this.width=Math.max(c.minWidth,this.width);T={height:this.getCurrentHeight()+this.inputHeight+"px",width:r(this.width-this.scrollWidthDiff)+"px"};if(typeof V!="undefined"){T.left=V+"px"}if(typeof U!="undefined"){T.top=U+"px"}this.$popup.css(T);this.$body.css({height:this.getCurrentHeight()+"px",width:this.width})}function z(){if(!this.smilieCache.isReady()){this.showSpinner();return}this.smilieCache.match();this.buildItems();this.lastSelected=null;this.select();if(this.keyCache.getLength()>=c.minLength){this.smilieCache.search()}}function P(){var W,Y,Z,R,S,U,T=this.smilieCache.getItemsLength(),V=this.smilieCache.getData(),X=(navigator.userAgent.toLowerCase().indexOf("msie")!==-1)?"hand":"pointer";this.items=this.smilieCache.getItems();if(T===0&&this.spinnerVisible==false){if(this.keyCache.getLength()>0){this.clear();this.$body.html(f("<span/>",{"class":"sm_typed_text"}).html(this.keyCache.getText()))}else{this.showInstructions()}if(this.isVisible()){this.move()}return}this.clear();for(W=0;W<T;W++){U=this.items[W];Y=V[U]["code"];if(this.keyCache.getText()){S=U.indexOf(this.keyCache.getText());if((c.fullText&&S!==-1)||(!c.fullText&&S===0)){Y=Y.slice(0,S)+'<span class="sm_name_highlight">'+Y.slice(S,S+this.keyCache.getLength())+"</span>"+Y.slice(S+this.keyCache.getLength())}}R=V[U]["url"];Z=f("<div/>",{"class":"sm_smilie_image"}).css({backgroundImage:"url("+R+")"});this.$body.append(f("<div/>",{"class":"sm_popup_item sm_popup_item_"+W}).append(Z).append(Y).css({cursor:X}))}if(this.isVisible()){this.move()}}function I(){this.$body.html("");this.lastSelected=null;this.spinnerVisible=false;if(this.isVisible()){this.move()}}function x(){this.clear();this.$body.html(this.$spinner);this.spinnerVisible=true;if(this.isVisible()){this.move()}}function N(){this.clear();this.$body.html(this.$instructions)}function L(){if(this.keyCache.update()){this.update()}}function H(R){var S=this.smilieCache.getItemsLength()-1;switch(R){case"last":this.selected=S;break;case"next":this.selected++;if(this.selected>S){this.selected=0}break;case"previous":this.selected--;if(this.selected<0){this.selected=S}break;case"nextPage":this.selected+=c.maxItems;if(this.selected>S){this.selected=S}break;case"previousPage":this.selected-=c.maxItems;if(this.selected<0){this.selected=0}break;default:this.selected=0;break}this.highlightSelected()}function Q(T){var S=this.$popup.find(".sm_popup_item_"+this.selected),U=this.$popup.find(".sm_popup_item_"+this.lastSelected),R=U.find("span.sm_name_highlight_on"),V=this.itemInView(S);if(this.lastSelected==this.selected||S.length==0){return}if(U.length){U.removeClass("sm_popup_item_on");if(R.length){R.removeClass("sm_name_highlight_on");R.addClass("sm_name_highlight")}}this.lastSelected=this.selected;if(S){if(!S.hasClass("sm_popup_item_on")){S.addClass("sm_popup_item_on")}R=S.find("span.sm_name_highlight");if(R.length){R.removeClass("sm_name_highlight");R.addClass("sm_name_highlight_on")}}if(T||(c.lockSelection!==1&&V===true)){return}if(c.lockSelection){if(this.smilieCache.getItemsLength()-c.maxItems>0){this.$body.prop("scrollTop",r(S.prop("offsetTop")-this.inputHeight))}return}if(this.selected==0){this.$body.prop("scrollTop",-this.inputHeight);return}if(V>0){this.$body.prop("scrollTop",r(S.prop("offsetTop")-(this.getCurrentHeight()-this.lineHeight)-this.inputHeight));return}this.$body.prop("scrollTop",r(S.prop("offsetTop")-this.inputHeight))}function F(R){var S=R.prop("offsetTop")-this.$body.prop("scrollTop");if(S>0&&(S+this.lineHeight)<this.getCurrentHeight()){return true}return S}function u(R){switch(R.keyCode){case s.ENTER:this.editorInterface.insert();break;case s.UP:this.select("previous");break;case s.DOWN:this.select("next");break;case s.END:this.select("last");break;case s.HOME:this.select();break;case s.PAGE_UP:this.select("previousPage");break;case s.PAGE_DOWN:this.select("nextPage");break;case s.ESC:this.hide();break;case s.BACKSPACE:if(this.$input.val()===""){this.hide();this.editorInterface.focus()}return;break;default:return}R.preventDefault()}function E(R){if(this.selectEventTarget(R)){this.highlightSelected(true)}}function y(R){if(this.selectEventTarget(R)){this.editorInterface.insert()}else{R.preventDefault()}}function B(R){R.stopPropagation()}function G(W){if(!W){return false}var R=f(W.target),T,U,V,S=false;if(R.length==0||!R.hasClass("sm_popup_item")){return}T=R.prop("class").split(" ");while(U=T.shift()){if(typeof U!=="undefined"&&["sm_popup_item","sm_popup_item_on"].indexOf(U)===-1&&U.indexOf("sm_popup_item_")===0){S=true;break}}V=U.split("_");if(!S||!V||V.length==0||!V[V.length-1]){return false}this.selected=V[V.length-1];return true}function M(){if(this.smilieCache.getItemsLength()===0||!this.items[this.selected]){return}return this.smilieCache.getData()[this.items[this.selected]]["code"]}function m(){return(this.lineHeight*Math.max(1,Math.min(c.maxItems,this.smilieCache.getItemsLength())))+this.editorInterface.heightModifier+4}function w(){return this.$input.val()}function A(){return this.lineHeight}function v(){return this.spinnerVisible}function K(){return this.visible}f.extend(D.prototype,{show:O,hide:C,move:J,update:z,buildItems:P,clear:I,showSpinner:x,showInstructions:N,updateCheck:L,select:H,highlightSelected:Q,itemInView:F,onKeyDown:u,onMouseMove:E,onClick:y,onInputClick:B,selectEventTarget:G,getSelectedSmilie:M,getCurrentHeight:m,getInputValue:w,getLineHeight:A,spinnerIsVisible:v,isVisible:K});return D})(),l=(function(){function x(z){this.popup=z;this.clear()}function m(){this.data="";this.mirror=""}function y(){var z=false,A=this.popup.getInputValue();if(this.data!==A){z=true}this.data=A;return z}function w(){return this.data.length}function u(z){if(z!=true){return this.data.toLowerCase()}return this.data}function v(z){this.data=z?z:""}f.extend(x.prototype,{clear:m,update:y,getLength:w,getText:u,setText:v});return x})(),a=(function(){function B(E){this.data={};this.allNames={};this.ready=false;this.loading=true;this.searching=false;this.searched=[];this.items=[];this.longestText=5;this.popup=E;this.editorInterface=this.popup.editorInterface;this.keyCache=E.keyCache;f.ajax({type:"post",url:"xmlhttp.php",data:{action:"sm",mode:"Load",tid:c.tid},success:this.OnLoad.bind(this)})}function C(E){this.ready=true;this.loading=false;f.extend(this.data,E);if(f.isEmptyObject(this.data)){this.data={};this.popup.hide();return}if(this.popup.isVisible()){this.popup.update()}}function x(){var G,F=0,E={};this.items=[];this.longestText=5;for(G in this.data){if(!this.checkEntry(G,this.data,E)){continue}this.items.push(G);E[G]=true;F++}this.items=this.items.sort(d);return F}function z(G,F,E){if(!F.hasOwnProperty(G)||!F[G]||E[G]||(this.keyCache.getLength()&&((!c.fullText&&G.slice(0,this.keyCache.getLength())!==this.keyCache.getText())||(c.fullText&&G.indexOf(this.keyCache.getText())===-1)))){return false}if(G.length>this.longestText){this.longestText=G.length}return true}function D(){this.match();this.popup.buildItems();this.popup.select()}function A(){return this.ready}function y(){return this.loading}function w(){return this.data}function u(){return this.items}function m(){return this.items.length}function v(){return this.longestText}f.extend(B.prototype,{OnLoad:C,match:x,checkEntry:z,search:D,isReady:A,isLoading:y,getData:w,getItems:u,getItemsLength:m,getlongestText:v});return B})(),e=(function(){function m(F){this.$textarea=f("#"+F);this.$container=this.$textarea.closest("div");this.selection={start:0,end:0};this.popup=new g(this);this.bindKeyup()}function E(F){if(this.popup.isVisible()){return}this.getCaret();if(j(F.keyCode)&&this.$textarea.val().slice(this.selection.start-1,this.selection.end)==":"){this.showPopup()}}function C(){var F=this.$textarea.caret("offset"),H=F.left+3,G=F.top-5;this.popup.show(H,G)}function B(){var F=o(this.popup);if(!F){if(!this.popup.spinnerIsVisible()){this.popup.hide()}return}this.getCaret();this.$textarea.val(this.$textarea.val().slice(0,this.selection.start-1)+F+this.$textarea.val().slice(this.selection.start));this.setCaret(this.selection.start+F.length);this.popup.hide()}function w(){var F=this.$textarea.caret("pos");this.selection.start=F;this.selection.end=F}function v(I,F){var H,G;if(typeof F==="undefined"){F=I}H=this.$textarea[0];if(H.setSelectionRange){H.focus();H.setSelectionRange(I,F)}else{if(H.createTextRange){G=H.createTextRange();G.collapse(true);G.moveEnd("character",F);G.moveStart("character",I);G.select()}}}function y(F){this.$textarea.click(F)}function u(F){this.$textarea.off("click",F)}function A(){this.$textarea.keyup(f.proxy(this.onKeyUp,this))}function x(){this.$textarea.off("keyup")}function D(){this.$textarea.focus()}function z(){return this.$container}f.extend(m.prototype,{heightModifier:0,lineHeightModifier:0,onKeyUp:E,showPopup:C,insert:B,getCaret:w,setCaret:v,bindClick:y,unbindClick:u,bindKeyup:A,unbindKeyup:x,focus:D,getContainer:z});return m})(),b=(function(){function v(){this.editor=MyBBEditor;this.rangeHelper=this.editor.getRangeHelper();this.$iFrame=f("div.sceditor-toolbar").next("iframe");this.$container=this.$iFrame.closest(".sceditor-container").parent();this.$body=f(this.editor.getBody());this.selection={start:0,end:0};this.popup=new g(this);this.editor.keyUp(this.onKeyUp.bind(this))}function A(C){this.getCaret();if(!C.keyCode){if(C.originalEvent&&C.originalEvent.keyCode){C.keyCode=C.originalEvent.keyCode}else{return}}if(!this.popup.isVisible()){if(j(C.keyCode)&&this.$currentNode.text().slice(this.selection.start-1,this.selection.end)==":"){this.showPopup()}return}}function z(){var E,G,F,D=this.$body.caret("offset",{iframe:this.$iFrame[0]}),C=this.$container.offset();E=7;if(this.$currentNode.closest("div").length&&typeof this.$currentNode.closest("div").css==="function"){E=r(this.$currentNode.closest("div").css("fontSize").replace("px","")/2)}G=r(D.left)+C.left+r(this.$container.css("paddingLeft").replace("px",""))+E+2;F=r(D.top+this.$container.find("div.sceditor-toolbar").height())+C.top+r(this.$container.css("paddingTop").replace("px",""))+6;this.popup.show(G,F)}function y(){var C=o(this.popup),E=new Range(),D=this.rangeHelper.selectedRange(),F=this.editor.currentNode();if(!C){if(!this.popup.spinnerIsVisible()){this.popup.hide()}return}this.editor.focus();E.setStart(F,D.endOffset-1);E.setEnd(F,D.endOffset);this.rangeHelper.selectRange(E);this.editor.insert(C);this.popup.hide()}function u(){var C=this.rangeHelper.selectedRange();if(C.startContainer){this.$currentNode=f(C.startContainer)}else{this.$currentNode=f(this.editor.currentNode())}this.selection.start=C.startOffset;this.selection.end=C.endOffset}function w(C){this.$body.click(C)}function m(C){this.$body.off("click",C)}function B(){this.$iFrame.focus()}function x(){return this.$container}f.extend(v.prototype,{heightModifier:0,lineHeightModifier:0,onKeyUp:A,showPopup:z,insert:y,getCaret:u,bindClick:w,unbindClick:m,focus:B,getContainer:x});return v})(),k=(function(){function m(I){if(f("#"+I).length===0||typeof CKEDITOR.instances[I]==="undefined"){return}this.finalized=false;this.id=I;this.editor=CKEDITOR.instances[this.id];if(this.editor.status!="ready"){this.editor.on("instanceReady",f.proxy(this.finalize,this))}else{this.finalize()}f("#quick_reply_submit").click(f.proxy(this.quickReplyPosted,this))}function C(){if(this.editor.mode=="wysiwyg"){this.doFinalize()}this.lastState=this.editor.mode;this.editor.on("mode",f.proxy(this.onModeChange,this))}function E(){this.$iFrame=f("#cke_"+this.id).find("iframe");this.$container=this.$iFrame.closest("div");this.$doc=f(this.editor.document.$);this.$body=this.$doc.find("body");this.bindKeyup();this.popup=new g(this);this.finalized=true}function A(I){if(typeof I.sender.mode=="undefined"||I.sender.mode==this.lastState){return}this.lastState=I.sender.mode;if(this.finalized){this.unbindKeyup()}if(I.sender.mode!="source"){this.doFinalize()}}function H(I){if(!this.popup.isVisible()){if(j(I.keyCode)&&this.getPrevChar()==":"){this.showPopup()}return}}function v(){if(typeof this.$doc!=="undefined"&&this.$doc.length){this.$doc.off("keyup",this.onKeyUp)}setTimeout(f.proxy(function(){this.$doc.keyup(f.proxy(this.onKeyUp,this))},this),500)}function F(){var I=this.$body.caret("offset",{iframe:this.$iFrame[0]}),L=this.$iFrame.offset(),K=r(I.left+L.left)+2,J=r(I.top+L.top)-5;this.popup.show(K,J)}function D(){var I=o(this.popup),J=this.editor.getSelection().getRanges()[0];if(!I){if(!this.popup.spinnerIsVisible()){this.popup.hide()}return}this.editor.focus();J.setStart(J.endContainer,J.startOffset-1);J.deleteContents();this.editor.insertText(I);this.popup.hide()}function x(){var J,L,K,I=this.editor.getSelection().getRanges()[0];if(!I||!I.startContainer){return null}J=I.startContainer;if(J.type==CKEDITOR.NODE_TEXT&&I.startOffset){return J.getText()[I.startOffset-1]}else{I.collapse(true);I.setStartAt(this.editor.editable(),CKEDITOR.POSITION_AFTER_START);L=new CKEDITOR.dom.walker(I);while(K=L.previous()){if(K.type==CKEDITOR.NODE_TEXT){return K.getText().slice(-1)}}}return null}function y(I){this.$doc.click(I)}function u(I){this.$doc.off("click",I)}function B(){this.$doc.keyup(f.proxy(this.onKeyUp,this))}function w(){this.$doc.off("keyup",this.onKeyUp)}function G(){this.editor.focus()}function z(){return this.$container}f.extend(m.prototype,{heightModifier:0,lineHeightModifier:0,finalize:C,doFinalize:E,onModeChange:A,onKeyUp:H,quickReplyPosted:v,showPopup:F,insert:D,getPrevChar:x,bindClick:y,unbindClick:u,bindKeyup:B,unbindKeyup:w,focus:G,getContainer:z});return m})();function n(m){f.extend(t,m.lang||{});delete m.lang;f.extend(c,m||{});f(["minLength","maxLength","minWidth","maxItems","fullText","lockSelection"]).each(function(){if(typeof c[this]!=="undefined"){c[this]=r(c[this])}})}function q(){var v,u,m=f('.panel > form > input[class="text"]');if(typeof CKEDITOR!=="undefined"&&typeof CKEDITOR.instances!=="undefined"){u=f.map(CKEDITOR.instances,function(x,w){return w})[0];if(typeof CKEDITOR.instances[u]!=="object"){return false}new k(u)}else{if(MyBBEditor!==null&&typeof MyBBEditor==="object"&&MyBBEditor.getRangeHelper&&typeof MyBBEditor.getRangeHelper==="function"){new b()}else{if(f("#message").length>0||f("#signature").length>0){if(f("#message").length){v="message"}else{if(f("#signature").length){v="signature"}}if(!v||!f("#"+v).length){return false}new e(v)}}}if(m.length){m.prop("id","dvz_shoutbox_input");new e("dvz_shoutbox_input")}f(".quick_edit_button").click(h);f("#quick_reply_submit").click(i)}function h(v){var m=this.id.split("_").slice(-1)[0],w="quickedit_"+m,u;if(f("#"+w).length==0){return}if(typeof CKEDITOR==="undefined"){u=new e(w)}else{setTimeout(function(){u=new k(w)},1100)}setTimeout(function(){f("#quicksub_"+m).add(f("#quicksub_"+m).next("button")).click(function(){u.unbindKeyup()})},1100)}function i(m){f(".quick_edit_button").off("click",h);setTimeout(function(){f(".quick_edit_button").click(h)},500)}function o(m){var u=m.getSelectedSmilie();if(!u){return}return u+" "}function j(m){return[s.LEFT,s.RIGHT,s.UP,s.DOWN,s.BACKSPACE,s.ESC,s.SHIFT,s.CTRL,s.ALT,s.ENTER,s.DELETE,s.INSERT,s.END,s.NUMLOCK].indexOf(m)===-1}function d(u,m){if(u.length<m.length){return -1}else{if(u.length>m.length){return 1}else{return 0}}}function r(m){return parseInt(m,10)}f(q);p.autoComplete={setup:n};return p})(jQuery,SmileMenu||{});